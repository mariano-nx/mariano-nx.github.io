<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<title> Demo Callbaxk </title>
		
		<script type="text/javascript" charset="utf-8">
		//console.log(window);
		var token = "";
		
		function start(){
			getToken();
			listQueues();
		}
		
		//get token
		function getToken(){
			//https://10pa4oa5di.execute-api.ca-central-1.amazonaws.com/default/Genesys_Lab_Access_Token
			fetch('https://10pa4oa5di.execute-api.ca-central-1.amazonaws.com/default/Genesys_Lab_Access_Token')
			.then(function (resp){
				console.log(resp);
				return resp.json();
			}).then(function (data){
				console.log(data);
				token=data.accessToken;
				console.log(token);
			}).catch(function (error){
				console.log("Error: ", error);
			});
			
		
			
		}
		
	
		
		
		
		function createCallback(){
			console.log(document.getElementById('fname').value);
			console.log(document.getElementById('phone').value);
			console.log(document.getElementById('queues').value);
			
			
		
		}
		
		function listQueues(){
			//get queues and list them in dropdown
			//fetch get queues
			fetch('https://q31c3yeol7.execute-api.ca-central-1.amazonaws.com/test/cors-proxy/https://api.mypurecloud.com/api/v2/routing/queues?pageSize=160',{
				method: 'get',
				headers:{
					'Content-Type':'application/json',
					'Authorization':'Bearer '+token
				}
			}).then(function (resp) {
				console.log(resp);
				// Return the response as JSON
				return resp.json();
				

			}).then(function (data) {

				// Log the API data
				//console.log('data ', data);
				return data.entities;

			})then(function (queues){
				console.log(queues);
				var dropdown = document.getElementById('queues');
				let defaultOption = document.createElement('option');
				defaultOption.text = 'Select Queue';

				dropdown.add(defaultOption);
				dropdown.selectedIndex = 0;
				let option;
				for(let item of queues){
					//console.log(item);
				  option = document.createElement('option');
				  option.text = item.name;
				  option.value = item.id;
				  dropdown.add(option);
				}
			
			}).catch(function (err) {

				// Log any errors
				console.log('something went wrong', err);

			});
		}
		  window.onload = start;
		</script>
	</head>
	<body>
		<form name="callback_form" action="javascript:createCallback()">
		  <label for="fname">First name:</label><br>
		  <input type="text" id="fname" name="fname"><br>
		  <label for="phone">Phone Number:</label><br>
		  <input type="text" id="phone" name="phone"><br>
		  <label for="queues">Please select a queue:</label><br>
		  <select  id="queues" name="queues">
		  </select><br>
		  <input id="createCB" type="submit" value="Schedule Callback">
		</form>

	</body>
</html>